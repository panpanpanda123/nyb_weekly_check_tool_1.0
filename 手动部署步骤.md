# ğŸš€ æ‰‹åŠ¨éƒ¨ç½²æ­¥éª¤ï¼ˆä»£ç å·²å…‹éš†ï¼‰

## å½“å‰çŠ¶æ€
âœ… ä»£ç å·²å…‹éš†åˆ°ï¼š`~/nyb_weekly_check_tool_1.0`

## æ¥ä¸‹æ¥çš„æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šç§»åŠ¨é¡¹ç›®åˆ°æ ‡å‡†ä½ç½®
```bash
# ç§»åŠ¨é¡¹ç›®åˆ° /opt ç›®å½•
sudo mv ~/nyb_weekly_check_tool_1.0 /opt/review-result-viewer

# è¿›å…¥é¡¹ç›®ç›®å½•
cd /opt/review-result-viewer
```

### ç¬¬äºŒæ­¥ï¼šå®‰è£…ç³»ç»Ÿä¾èµ–
```bash
# æ›´æ–°ç³»ç»ŸåŒ…
sudo apt-get update

# å®‰è£… Pythonã€PostgreSQLã€Nginx
sudo apt-get install -y python3.10 python3.10-venv python3-pip postgresql postgresql-contrib nginx git
```

### ç¬¬ä¸‰æ­¥ï¼šé…ç½® PostgreSQL æ•°æ®åº“
```bash
# å¯åŠ¨ PostgreSQL
sudo systemctl start postgresql
sudo systemctl enable postgresql

# åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·ï¼ˆå¤åˆ¶æ•´æ®µä¸€èµ·è¿è¡Œï¼‰
sudo -u postgres psql <<EOF
DROP DATABASE IF EXISTS review_viewer_db;
DROP USER IF EXISTS review_viewer;
CREATE USER review_viewer WITH PASSWORD 'your_password_123';
CREATE DATABASE review_viewer_db OWNER review_viewer;
GRANT ALL PRIVILEGES ON DATABASE review_viewer_db TO review_viewer;
EOF
```

### ç¬¬å››æ­¥ï¼šåˆ›å»º Python è™šæ‹Ÿç¯å¢ƒ
```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3.10 -m venv /opt/review-result-viewer/venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source /opt/review-result-viewer/venv/bin/activate

# å‡çº§ pip
pip install --upgrade pip

# å®‰è£…ä¾èµ–
pip install -r /opt/review-result-viewer/requirements.txt
pip install gunicorn
```

### ç¬¬äº”æ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡
```bash
# åˆ›å»º .env æ–‡ä»¶
cat > /opt/review-result-viewer/.env <<EOF
DATABASE_URL=postgresql://review_viewer:your_password_123@localhost:5432/review_viewer_db
FLASK_ENV=production
SECRET_KEY=$(openssl rand -hex 32)
UPLOAD_FOLDER=/opt/review-result-viewer/viewer/uploads
MAX_CONTENT_LENGTH=52428800
EOF

# è®¾ç½®æƒé™
chmod 600 /opt/review-result-viewer/.env
```

### ç¬¬å…­æ­¥ï¼šåˆå§‹åŒ–æ•°æ®åº“è¡¨
```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼ˆå¦‚æœè¿˜æ²¡æ¿€æ´»ï¼‰
source /opt/review-result-viewer/venv/bin/activate

# åˆå§‹åŒ–æ•°æ®åº“
cd /opt/review-result-viewer
export DATABASE_URL="postgresql://review_viewer:your_password_123@localhost:5432/review_viewer_db"
python3 -c "
from shared.database_models import create_db_engine, init_viewer_db
import os
engine = create_db_engine(os.getenv('DATABASE_URL'))
init_viewer_db(engine)
print('æ•°æ®åº“è¡¨åˆ›å»ºæˆåŠŸ')
"
```

### ç¬¬ä¸ƒæ­¥ï¼šé…ç½® Nginx
```bash
# å¤åˆ¶ Nginx é…ç½®
sudo cp /opt/review-result-viewer/deploy/nginx.conf /etc/nginx/sites-available/review-viewer

# ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„è·¯å¾„
sudo sed -i 's|/path/to/project|/opt/review-result-viewer|g' /etc/nginx/sites-available/review-viewer

# å¯ç”¨ç«™ç‚¹
sudo ln -sf /etc/nginx/sites-available/review-viewer /etc/nginx/sites-enabled/review-viewer

# æµ‹è¯• Nginx é…ç½®
sudo nginx -t

# é‡å¯ Nginx
sudo systemctl restart nginx
sudo systemctl enable nginx
```

### ç¬¬å…«æ­¥ï¼šé…ç½® Systemd æœåŠ¡
```bash
# å¤åˆ¶æœåŠ¡é…ç½®
sudo cp /opt/review-result-viewer/deploy/review-viewer.service /etc/systemd/system/review-viewer.service

# ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„è·¯å¾„
sudo sed -i 's|/path/to/project|/opt/review-result-viewer|g' /etc/systemd/system/review-viewer.service
sudo sed -i 's|/path/to/venv|/opt/review-result-viewer/venv|g' /etc/systemd/system/review-viewer.service

# é‡æ–°åŠ è½½ systemd
sudo systemctl daemon-reload

# å¯åŠ¨æœåŠ¡
sudo systemctl start review-viewer
sudo systemctl enable review-viewer

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status review-viewer
```

### ç¬¬ä¹æ­¥ï¼šæ£€æŸ¥æœåŠ¡
```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status review-viewer

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
sudo journalctl -u review-viewer -f

# æ£€æŸ¥ç«¯å£
sudo netstat -tlnp | grep 8000
sudo netstat -tlnp | grep 80
```

### ç¬¬åæ­¥ï¼šè®¿é—®ç³»ç»Ÿ
åœ¨æµè§ˆå™¨æ‰“å¼€ï¼š
- å±•ç¤ºé¡µé¢ï¼šhttp://172.22.181.185
- ç®¡ç†é¡µé¢ï¼šhttp://172.22.181.185/admin/upload

---

## å¦‚æœé‡åˆ°é—®é¢˜

### æœåŠ¡æ— æ³•å¯åŠ¨
```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
sudo journalctl -u review-viewer -n 100 --no-pager

# æ‰‹åŠ¨æµ‹è¯•è¿è¡Œ
cd /opt/review-result-viewer
source venv/bin/activate
python3 viewer/app_viewer.py
```

### æ•°æ®åº“è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥ PostgreSQL çŠ¶æ€
sudo systemctl status postgresql

# æµ‹è¯•æ•°æ®åº“è¿æ¥
sudo -u postgres psql -l

# é‡ç½®æ•°æ®åº“å¯†ç 
sudo -u postgres psql -c "ALTER USER review_viewer WITH PASSWORD 'your_password_123';"
```

### Nginx é”™è¯¯
```bash
# æ£€æŸ¥ Nginx çŠ¶æ€
sudo systemctl status nginx

# æŸ¥çœ‹ Nginx é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/error.log

# æµ‹è¯•é…ç½®
sudo nginx -t
```

### ç«¯å£è¢«å ç”¨
```bash
# æŸ¥çœ‹ 80 ç«¯å£å ç”¨
sudo lsof -i :80

# æŸ¥çœ‹ 8000 ç«¯å£å ç”¨
sudo lsof -i :8000
```

---

## å¿«é€Ÿå‘½ä»¤æ±‡æ€»

```bash
# 1. ç§»åŠ¨é¡¹ç›®
sudo mv ~/nyb_weekly_check_tool_1.0 /opt/review-result-viewer

# 2. å®‰è£…ä¾èµ–
sudo apt-get update && sudo apt-get install -y python3.10 python3.10-venv python3-pip postgresql postgresql-contrib nginx git

# 3. åˆ›å»ºæ•°æ®åº“
sudo systemctl start postgresql
sudo -u postgres psql -c "CREATE USER review_viewer WITH PASSWORD 'your_password_123';"
sudo -u postgres psql -c "CREATE DATABASE review_viewer_db OWNER review_viewer;"

# 4. å®‰è£… Python åŒ…
cd /opt/review-result-viewer
python3.10 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
pip install gunicorn

# 5. åˆå§‹åŒ–æ•°æ®åº“
export DATABASE_URL="postgresql://review_viewer:your_password_123@localhost:5432/review_viewer_db"
python3 -c "from shared.database_models import create_db_engine, init_viewer_db; import os; engine = create_db_engine(os.getenv('DATABASE_URL')); init_viewer_db(engine)"

# 6. é…ç½®å¹¶å¯åŠ¨æœåŠ¡
sudo cp deploy/nginx.conf /etc/nginx/sites-available/review-viewer
sudo sed -i 's|/path/to/project|/opt/review-result-viewer|g' /etc/nginx/sites-available/review-viewer
sudo ln -sf /etc/nginx/sites-available/review-viewer /etc/nginx/sites-enabled/
sudo cp deploy/review-viewer.service /etc/systemd/system/
sudo sed -i 's|/path/to/project|/opt/review-result-viewer|g' /etc/systemd/system/review-viewer.service
sudo sed -i 's|/path/to/venv|/opt/review-result-viewer/venv|g' /etc/systemd/system/review-viewer.service
sudo systemctl daemon-reload
sudo systemctl start review-viewer
sudo systemctl start nginx
sudo systemctl enable review-viewer
sudo systemctl enable nginx
```

---

**å®Œæˆåè®¿é—®**: http://172.22.181.185
