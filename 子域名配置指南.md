# å­åŸŸåé…ç½®æŒ‡å—

## ç›®æ ‡
ä½¿ç”¨ `weeklycheck.blitzepanda.top` è®¿é—®å‘¨æ¸…å®¡æ ¸ç³»ç»Ÿ

## é…ç½®æ­¥éª¤

### æ­¥éª¤1ï¼šDNSé…ç½®

åœ¨ä½ çš„åŸŸåæœåŠ¡å•†ï¼ˆé˜¿é‡Œäº‘/è…¾è®¯äº‘ç­‰ï¼‰æ·»åŠ DNSè®°å½•ï¼š

```
ç±»åž‹: Aè®°å½•
ä¸»æœºè®°å½•: weeklycheck
è®°å½•å€¼: [ä½ çš„æœåŠ¡å™¨IP]
TTL: 600ï¼ˆæˆ–é»˜è®¤ï¼‰
```

**å¦‚ä½•æŸ¥çœ‹æœåŠ¡å™¨IP**ï¼š
```bash
ssh root@blitzepanda.top "curl ifconfig.me"
```

### æ­¥éª¤2ï¼šNginxé…ç½®

#### æ–¹æ¡ˆAï¼šç‹¬ç«‹serverå—ï¼ˆæŽ¨èï¼‰

SSHåˆ°æœåŠ¡å™¨ï¼š
```bash
ssh root@blitzepanda.top
```

åˆ›å»ºæ–°çš„Nginxé…ç½®æ–‡ä»¶ï¼š
```bash
nano /etc/nginx/sites-available/weeklycheck
```

æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š
```nginx
server {
    listen 80;
    server_name weeklycheck.blitzepanda.top;
    
    # æ—¥å¿—
    access_log /var/log/nginx/weeklycheck_access.log;
    error_log /var/log/nginx/weeklycheck_error.log;
    
    # æ ¹è·¯å¾„ - å‘¨æ¸…å®¡æ ¸ç³»ç»Ÿ
    location / {
        proxy_pass http://127.0.0.1:5001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # è¶…æ—¶è®¾ç½®
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }
    
    # APIè·¯å¾„
    location /api {
        proxy_pass http://127.0.0.1:5001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    
    # é™æ€æ–‡ä»¶
    location /static {
        alias /opt/review-result-viewer/static;
        expires 30d;
        add_header Cache-Control "public, immutable";
    }
}
```

å¯ç”¨é…ç½®ï¼š
```bash
# åˆ›å»ºè½¯é“¾æŽ¥
ln -s /etc/nginx/sites-available/weeklycheck /etc/nginx/sites-enabled/

# æµ‹è¯•é…ç½®
nginx -t

# é‡è½½Nginx
systemctl reload nginx
```

#### æ–¹æ¡ˆBï¼šåœ¨çŽ°æœ‰é…ç½®ä¸­æ·»åŠ ï¼ˆå¦‚æžœä½ å·²ç»ä¿®æ”¹äº†defaultï¼‰

ç¼–è¾‘çŽ°æœ‰é…ç½®ï¼š
```bash
nano /etc/nginx/sites-available/default
```

åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ æ–°çš„serverå—ï¼š
```nginx
# å‘¨æ¸…å®¡æ ¸ç³»ç»Ÿ - å­åŸŸå
server {
    listen 80;
    server_name weeklycheck.blitzepanda.top;
    
    access_log /var/log/nginx/weeklycheck_access.log;
    error_log /var/log/nginx/weeklycheck_error.log;
    
    location / {
        proxy_pass http://127.0.0.1:5001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    
    location /api {
        proxy_pass http://127.0.0.1:5001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    
    location /static {
        alias /opt/review-result-viewer/static;
        expires 30d;
        add_header Cache-Control "public, immutable";
    }
}
```

æµ‹è¯•å¹¶é‡è½½ï¼š
```bash
nginx -t && systemctl reload nginx
```

### æ­¥éª¤3ï¼šå¯åŠ¨å‘¨æ¸…å®¡æ ¸æœåŠ¡

ç¡®ä¿æœåŠ¡åœ¨5001ç«¯å£è¿è¡Œï¼š

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
systemctl status review-viewer

# å¦‚æžœæ²¡æœ‰æœåŠ¡ï¼Œéœ€è¦åˆ›å»º
cat > /etc/systemd/system/review-viewer.service << 'EOF'
[Unit]
Description=Weekly Check Review System
After=network.target

[Service]
Type=simple
User=root
WorkingDirectory=/opt/review-result-viewer
ExecStart=/usr/bin/python3 app.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF

# å¯åŠ¨æœåŠ¡
systemctl daemon-reload
systemctl enable review-viewer
systemctl start review-viewer
```

### æ­¥éª¤4ï¼šéªŒè¯é…ç½®

```bash
# 1. æ£€æŸ¥DNSè§£æž
ping weeklycheck.blitzepanda.top

# 2. æ£€æŸ¥Nginxé…ç½®
nginx -t

# 3. æ£€æŸ¥æœåŠ¡çŠ¶æ€
systemctl status review-viewer

# 4. æ£€æŸ¥ç«¯å£ç›‘å¬
netstat -tlnp | grep 5001

# 5. æµ‹è¯•æœ¬åœ°è®¿é—®
curl http://127.0.0.1:5001

# 6. æµ‹è¯•å¤–ç½‘è®¿é—®
curl http://weeklycheck.blitzepanda.top
```

### æ­¥éª¤5ï¼šé…ç½®HTTPSï¼ˆå¯é€‰ä½†æŽ¨èï¼‰

ä½¿ç”¨Let's Encryptå…è´¹SSLè¯ä¹¦ï¼š

```bash
# å®‰è£…certbot
apt-get update
apt-get install certbot python3-certbot-nginx

# è‡ªåŠ¨é…ç½®SSL
certbot --nginx -d weeklycheck.blitzepanda.top

# è‡ªåŠ¨ç»­æœŸ
certbot renew --dry-run
```

é…ç½®åŽï¼ŒNginxä¼šè‡ªåŠ¨æ·»åŠ HTTPSé…ç½®ï¼š
```nginx
server {
    listen 443 ssl;
    server_name weeklycheck.blitzepanda.top;
    
    ssl_certificate /etc/letsencrypt/live/weeklycheck.blitzepanda.top/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/weeklycheck.blitzepanda.top/privkey.pem;
    
    # ... å…¶ä»–é…ç½®åŒä¸Š
}

# HTTPè‡ªåŠ¨è·³è½¬HTTPS
server {
    listen 80;
    server_name weeklycheck.blitzepanda.top;
    return 301 https://$server_name$request_uri;
}
```

---

## å¿«é€Ÿé…ç½®è„šæœ¬

åˆ›å»ºä¸€é”®é…ç½®è„šæœ¬ï¼š

```bash
ssh root@blitzepanda.top

cat > /tmp/setup_weeklycheck_subdomain.sh << 'SCRIPT'
#!/bin/bash

echo "=========================================="
echo "é…ç½® weeklycheck.blitzepanda.top"
echo "=========================================="
echo

# 1. åˆ›å»ºNginxé…ç½®
echo "ðŸ“ åˆ›å»ºNginxé…ç½®..."
cat > /etc/nginx/sites-available/weeklycheck << 'EOF'
server {
    listen 80;
    server_name weeklycheck.blitzepanda.top;
    
    access_log /var/log/nginx/weeklycheck_access.log;
    error_log /var/log/nginx/weeklycheck_error.log;
    
    location / {
        proxy_pass http://127.0.0.1:5001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }
    
    location /api {
        proxy_pass http://127.0.0.1:5001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    
    location /static {
        alias /opt/review-result-viewer/static;
        expires 30d;
        add_header Cache-Control "public, immutable";
    }
}
EOF

# 2. å¯ç”¨é…ç½®
echo "ðŸ”— å¯ç”¨Nginxé…ç½®..."
ln -sf /etc/nginx/sites-available/weeklycheck /etc/nginx/sites-enabled/

# 3. æµ‹è¯•Nginxé…ç½®
echo "ðŸ§ª æµ‹è¯•Nginxé…ç½®..."
if nginx -t; then
    echo "âœ… Nginxé…ç½®æ­£ç¡®"
else
    echo "âŒ Nginxé…ç½®é”™è¯¯"
    exit 1
fi

# 4. é‡è½½Nginx
echo "ðŸ”„ é‡è½½Nginx..."
systemctl reload nginx

# 5. æ£€æŸ¥æœåŠ¡
echo "ðŸ” æ£€æŸ¥å‘¨æ¸…å®¡æ ¸æœåŠ¡..."
if systemctl is-active --quiet review-viewer; then
    echo "âœ… æœåŠ¡æ­£åœ¨è¿è¡Œ"
else
    echo "âš ï¸  æœåŠ¡æœªè¿è¡Œï¼Œå°è¯•å¯åŠ¨..."
    systemctl start review-viewer
    sleep 2
    if systemctl is-active --quiet review-viewer; then
        echo "âœ… æœåŠ¡å¯åŠ¨æˆåŠŸ"
    else
        echo "âŒ æœåŠ¡å¯åŠ¨å¤±è´¥"
        echo "è¯·æ£€æŸ¥: systemctl status review-viewer"
    fi
fi

echo
echo "=========================================="
echo "âœ… é…ç½®å®Œæˆï¼"
echo "=========================================="
echo
echo "è®¿é—®åœ°å€: http://weeklycheck.blitzepanda.top"
echo
echo "éªŒè¯æ­¥éª¤:"
echo "1. ç¡®ä¿DNSå·²é…ç½®ï¼ˆAè®°å½•æŒ‡å‘æœåŠ¡å™¨IPï¼‰"
echo "2. ç­‰å¾…DNSç”Ÿæ•ˆï¼ˆå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼‰"
echo "3. è®¿é—® http://weeklycheck.blitzepanda.top"
echo
echo "å¦‚éœ€é…ç½®HTTPS:"
echo "certbot --nginx -d weeklycheck.blitzepanda.top"
echo
SCRIPT

chmod +x /tmp/setup_weeklycheck_subdomain.sh
/tmp/setup_weeklycheck_subdomain.sh
```

---

## æ•…éšœæŽ’æŸ¥

### é—®é¢˜1: æ— æ³•è®¿é—®å­åŸŸå

**æ£€æŸ¥DNS**ï¼š
```bash
# æŸ¥çœ‹DNSè§£æž
nslookup weeklycheck.blitzepanda.top

# æˆ–
dig weeklycheck.blitzepanda.top
```

å¦‚æžœæ²¡æœ‰è§£æžç»“æžœï¼Œéœ€è¦åœ¨åŸŸåæœåŠ¡å•†æ·»åŠ Aè®°å½•ã€‚

### é—®é¢˜2: 502 Bad Gateway

**åŽŸå› **ï¼šåŽç«¯æœåŠ¡æœªè¿è¡Œ

**è§£å†³**ï¼š
```bash
# æ£€æŸ¥æœåŠ¡
systemctl status review-viewer

# å¯åŠ¨æœåŠ¡
systemctl start review-viewer

# æŸ¥çœ‹æ—¥å¿—
journalctl -u review-viewer -n 50
```

### é—®é¢˜3: 404 Not Found

**åŽŸå› **ï¼šNginxé…ç½®è·¯å¾„é”™è¯¯

**è§£å†³**ï¼š
```bash
# æ£€æŸ¥é…ç½®
nginx -t

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f /var/log/nginx/weeklycheck_error.log
```

### é—®é¢˜4: é™æ€æ–‡ä»¶404

**åŽŸå› **ï¼šé™æ€æ–‡ä»¶è·¯å¾„ä¸å¯¹

**è§£å†³**ï¼š
```bash
# æ£€æŸ¥é™æ€æ–‡ä»¶ç›®å½•
ls -la /opt/review-result-viewer/static

# å¦‚æžœä¸å­˜åœ¨ï¼Œæ£€æŸ¥å®žé™…è·¯å¾„
find /opt/review-result-viewer -name "*.css" -o -name "*.js"
```

---

## è®¿é—®åœ°å€å¯¹æ¯”

é…ç½®å®ŒæˆåŽï¼š

| ç³»ç»Ÿ | æ—§åœ°å€ | æ–°åœ°å€ |
|------|--------|--------|
| å‘¨æ¸…å®¡æ ¸ | http://blitzepanda.top/weeklycheck | http://weeklycheck.blitzepanda.top |
| é—¨åº—è¯„çº§ | http://blitzepanda.top/rating | http://blitzepanda.top/rating |

---

## æ³¨æ„äº‹é¡¹

1. **DNSç”Ÿæ•ˆæ—¶é—´**ï¼šDNSè®°å½•æ·»åŠ åŽå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿåˆ°å‡ å°æ—¶ç”Ÿæ•ˆ
2. **é˜²ç«å¢™**ï¼šç¡®ä¿æœåŠ¡å™¨80ç«¯å£ï¼ˆHTTPï¼‰å’Œ443ç«¯å£ï¼ˆHTTPSï¼‰å¼€æ”¾
3. **æœåŠ¡ç«¯å£**ï¼šç¡®ä¿å‘¨æ¸…å®¡æ ¸æœåŠ¡è¿è¡Œåœ¨5001ç«¯å£
4. **å¤‡ä»½é…ç½®**ï¼šä¿®æ”¹Nginxé…ç½®å‰å…ˆå¤‡ä»½

---

## å®Œæ•´æ£€æŸ¥æ¸…å•

é…ç½®å®ŒæˆåŽï¼ŒæŒ‰æ­¤æ¸…å•éªŒè¯ï¼š

- [ ] DNS Aè®°å½•å·²æ·»åŠ 
- [ ] DNSè§£æžæ­£å¸¸ï¼ˆpingé€šï¼‰
- [ ] Nginxé…ç½®å·²åˆ›å»º
- [ ] Nginxé…ç½®æµ‹è¯•é€šè¿‡ï¼ˆnginx -tï¼‰
- [ ] Nginxå·²é‡è½½
- [ ] å‘¨æ¸…å®¡æ ¸æœåŠ¡è¿è¡Œæ­£å¸¸ï¼ˆsystemctl status review-viewerï¼‰
- [ ] ç«¯å£5001æ­£åœ¨ç›‘å¬ï¼ˆnetstat -tlnp | grep 5001ï¼‰
- [ ] æœ¬åœ°è®¿é—®æ­£å¸¸ï¼ˆcurl http://127.0.0.1:5001ï¼‰
- [ ] å­åŸŸåè®¿é—®æ­£å¸¸ï¼ˆcurl http://weeklycheck.blitzepanda.topï¼‰
- [ ] æµè§ˆå™¨è®¿é—®æ­£å¸¸
- [ ] é™æ€æ–‡ä»¶åŠ è½½æ­£å¸¸ï¼ˆCSS/JSï¼‰
- [ ] APIæŽ¥å£æ­£å¸¸
- [ ] ï¼ˆå¯é€‰ï¼‰HTTPSé…ç½®å®Œæˆ

---

## éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æžœé‡åˆ°é—®é¢˜ï¼Œæä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

```bash
# 1. Nginxé…ç½®æµ‹è¯•
nginx -t

# 2. æœåŠ¡çŠ¶æ€
systemctl status review-viewer

# 3. ç«¯å£ç›‘å¬
netstat -tlnp | grep 5001

# 4. Nginxé”™è¯¯æ—¥å¿—
tail -50 /var/log/nginx/weeklycheck_error.log

# 5. æœåŠ¡æ—¥å¿—
journalctl -u review-viewer -n 50

# 6. DNSè§£æž
nslookup weeklycheck.blitzepanda.top
```
