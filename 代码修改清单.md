# äº‘æœåŠ¡å™¨éƒ¨ç½² - ä»£ç ä¿®æ”¹æ¸…å•

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. æ–°å¢é…ç½®æ–‡ä»¶
- [x] `config.py` - ç»Ÿä¸€é…ç½®ç®¡ç†
- [x] `.env.example` - ç¯å¢ƒå˜é‡æ¨¡æ¿
- [x] `gunicorn_config.py` - Gunicornç”Ÿäº§ç¯å¢ƒé…ç½®
- [x] `app_cloud.py` - é€‚é…äº‘æœåŠ¡å™¨çš„åº”ç”¨ç‰ˆæœ¬
- [x] `start_server.sh` - å¯åŠ¨è„šæœ¬
- [x] `äº‘æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—.md` - å®Œæ•´éƒ¨ç½²æ–‡æ¡£

### 2. æ›´æ–°çš„æ–‡ä»¶
- [x] `requirements.txt` - æ·»åŠ ç”Ÿäº§ç¯å¢ƒä¾èµ–ï¼ˆgunicorn, python-dotenv, geventï¼‰

---

## ğŸ”§ éœ€è¦æ‰‹åŠ¨ä¿®æ”¹çš„åœ°æ–¹

### æ–¹æ¡ˆAï¼šä½¿ç”¨æ–°çš„app_cloud.pyï¼ˆæ¨èï¼‰

**ä¼˜ç‚¹**ï¼š
- ä¸å½±å“ç°æœ‰çš„app.py
- å¯ä»¥åŒæ—¶ä¿ç•™æœ¬åœ°å¼€å‘ç‰ˆæœ¬å’Œäº‘æœåŠ¡å™¨ç‰ˆæœ¬
- é…ç½®æ›´çµæ´»

**æ­¥éª¤**ï¼š
1. å°† `app_cloud.py` é‡å‘½åä¸º `app.py`ï¼ˆæˆ–åœ¨å¯åŠ¨æ—¶æŒ‡å®šä½¿ç”¨app_cloud.pyï¼‰
2. åˆ›å»º `.env` æ–‡ä»¶ï¼ˆä» `.env.example` å¤åˆ¶ï¼‰
3. ä¿®æ”¹ `.env` ä¸­çš„é…ç½®

### æ–¹æ¡ˆBï¼šä¿®æ”¹ç°æœ‰çš„app.py

å¦‚æœæ‚¨æƒ³ç›´æ¥ä¿®æ”¹ç°æœ‰çš„ `app.py`ï¼Œéœ€è¦ä¿®æ”¹ä»¥ä¸‹3å¤„ï¼š

#### ä¿®æ”¹1: æ–‡ä»¶å¼€å¤´æ·»åŠ å¯¼å…¥
```python
# åœ¨æ–‡ä»¶å¼€å¤´æ·»åŠ 
from config import (
    HOST, PORT, DEBUG, WHITELIST_FILE, 
    ADMIN_USERS, LOG_LEVEL, LOG_FILE
)
```

#### ä¿®æ”¹2: æ›¿æ¢ç¡¬ç¼–ç è·¯å¾„ï¼ˆ3å¤„ï¼‰
æ‰¾åˆ°è¿™3è¡Œï¼š
```python
# ç¬¬278è¡Œ
whitelist_file = 'D:/pythonproject/Newyobo_operat_database/daily_data/whitelist/whitelist.xlsx'

# ç¬¬331è¡Œ
whitelist_file = 'D:/pythonproject/Newyobo_operat_database/daily_data/whitelist/whitelist.xlsx'

# ç¬¬401è¡Œ
whitelist_file = 'D:/pythonproject/Newyobo_operat_database/daily_data/whitelist/whitelist.xlsx'
```

å…¨éƒ¨æ›¿æ¢ä¸ºï¼š
```python
whitelist_file = WHITELIST_FILE
```

#### ä¿®æ”¹3: ä¿®æ”¹å¯åŠ¨é…ç½®
æ‰¾åˆ°æœ€åçš„å¯åŠ¨ä»£ç ï¼š
```python
# åŸä»£ç 
app.run(host='0.0.0.0', port=5001, debug=True)
```

ä¿®æ”¹ä¸ºï¼š
```python
# æ–°ä»£ç 
app.run(host=HOST, port=PORT, debug=DEBUG)
```

---

## ğŸ“‹ éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•

### æœ¬åœ°å‡†å¤‡
- [ ] ç¡®è®¤æ‰€æœ‰ä»£ç ä¿®æ”¹å·²å®Œæˆ
- [ ] æµ‹è¯•æœ¬åœ°è¿è¡Œæ˜¯å¦æ­£å¸¸
- [ ] å‡†å¤‡å¥½ç™½åå•Excelæ–‡ä»¶
- [ ] å‡†å¤‡å¥½æ£€æŸ¥é¡¹è®°å½•Excelæ–‡ä»¶

### äº‘æœåŠ¡å™¨å‡†å¤‡
- [ ] å·²è´­ä¹°äº‘æœåŠ¡å™¨ï¼ˆæ¨èé…ç½®ï¼š2æ ¸4Gä»¥ä¸Šï¼‰
- [ ] å·²å®‰è£…Python 3.8+
- [ ] å·²å®‰è£…PostgreSQL
- [ ] å·²é…ç½®é˜²ç«å¢™è§„åˆ™
- [ ] å·²è·å–æœåŠ¡å™¨IPåœ°å€å’ŒSSHè®¿é—®æƒé™

### æ–‡ä»¶ä¸Šä¼ 
- [ ] ä¸Šä¼ é¡¹ç›®ä»£ç åˆ°æœåŠ¡å™¨
- [ ] ä¸Šä¼ ç™½åå•æ–‡ä»¶åˆ° `/var/www/inspection_system/data/`
- [ ] ä¸Šä¼ æ£€æŸ¥é¡¹è®°å½•æ–‡ä»¶åˆ°é¡¹ç›®æ ¹ç›®å½•

### é…ç½®æ–‡ä»¶
- [ ] åˆ›å»º `.env` æ–‡ä»¶
- [ ] é…ç½®æ•°æ®åº“è¿æ¥ä¿¡æ¯
- [ ] é…ç½®æ–‡ä»¶è·¯å¾„
- [ ] é…ç½®ç®¡ç†å‘˜ç”¨æˆ·

### æ•°æ®åº“
- [ ] PostgreSQLæœåŠ¡å·²å¯åŠ¨
- [ ] å·²åˆ›å»ºæ•°æ®åº“
- [ ] å·²åˆ›å»ºæ•°æ®åº“ç”¨æˆ·
- [ ] å·²æˆäºˆæƒé™
- [ ] å·²è¿è¡Œåˆå§‹åŒ–è„šæœ¬

### æµ‹è¯•
- [ ] æµ‹è¯•æ•°æ®åº“è¿æ¥
- [ ] æµ‹è¯•åº”ç”¨å¯åŠ¨
- [ ] æµ‹è¯•ç½‘é¡µè®¿é—®
- [ ] æµ‹è¯•æ–‡ä»¶ä¸Šä¼ 
- [ ] æµ‹è¯•å®¡æ ¸åŠŸèƒ½
- [ ] æµ‹è¯•CSVå¯¼å‡º

### ç”Ÿäº§ç¯å¢ƒ
- [ ] é…ç½®Gunicorn
- [ ] é…ç½®SystemdæœåŠ¡
- [ ] é…ç½®Nginxåå‘ä»£ç†ï¼ˆå¯é€‰ï¼‰
- [ ] é…ç½®SSLè¯ä¹¦ï¼ˆå¯é€‰ï¼‰
- [ ] é…ç½®æ—¥å¿—è½®è½¬
- [ ] é…ç½®è‡ªåŠ¨å¤‡ä»½

---

## ğŸš€ å¿«é€Ÿéƒ¨ç½²å‘½ä»¤

### 1. ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨
```bash
# åœ¨æœ¬åœ°æ‰§è¡Œ
scp -r ./* user@your-server-ip:/var/www/inspection_system/
```

### 2. åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
```bash
# SSHè¿æ¥åˆ°æœåŠ¡å™¨
ssh user@your-server-ip

# è¿›å…¥é¡¹ç›®ç›®å½•
cd /var/www/inspection_system

# èµ‹äºˆå¯åŠ¨è„šæœ¬æ‰§è¡Œæƒé™
chmod +x start_server.sh

# åˆ›å»º.envæ–‡ä»¶
cp .env.example .env
nano .env  # ç¼–è¾‘é…ç½®

# åˆ›å»ºæ•°æ®ç›®å½•å¹¶ä¸Šä¼ ç™½åå•
mkdir -p data
# ç„¶åä¸Šä¼ whitelist.xlsxåˆ°dataç›®å½•

# è¿è¡Œå¯åŠ¨è„šæœ¬
./start_server.sh
```

### 3. é…ç½®SystemdæœåŠ¡ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
```bash
# åˆ›å»ºæœåŠ¡æ–‡ä»¶
sudo nano /etc/systemd/system/inspection.service

# ç²˜è´´æœåŠ¡é…ç½®ï¼ˆè§äº‘æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—.mdï¼‰

# å¯åŠ¨æœåŠ¡
sudo systemctl daemon-reload
sudo systemctl start inspection
sudo systemctl enable inspection
sudo systemctl status inspection
```

---

## ğŸ” å…³é”®é…ç½®è¯´æ˜

### .env æ–‡ä»¶é…ç½®ç¤ºä¾‹
```bash
# ç”Ÿäº§ç¯å¢ƒ
FLASK_ENV=production

# æ•°æ®åº“ï¼ˆé‡è¦ï¼ä¿®æ”¹å¯†ç ï¼‰
DATABASE_URL=postgresql://inspection_user:your_strong_password@localhost:5432/configurable_ops

# æ–‡ä»¶è·¯å¾„ï¼ˆæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ï¼‰
WHITELIST_FILE=/var/www/inspection_system/data/whitelist.xlsx
EXCEL_FILE=æ£€æŸ¥é¡¹è®°å½•.xlsx

# å®‰å…¨å¯†é’¥ï¼ˆé‡è¦ï¼ç”Ÿæˆéšæœºå¯†é’¥ï¼‰
SECRET_KEY=è¯·ä½¿ç”¨éšæœºç”Ÿæˆçš„é•¿å­—ç¬¦ä¸²

# ç®¡ç†å‘˜ç”¨æˆ·
ADMIN_USERS=çª¦,ç®¡ç†å‘˜
```

### ç”Ÿæˆå®‰å…¨å¯†é’¥
```bash
python3 -c "import secrets; print(secrets.token_hex(32))"
```

---

## âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹

### 1. è·¯å¾„é—®é¢˜
- Windowsè·¯å¾„ï¼š`D:/path/to/file`
- Linuxè·¯å¾„ï¼š`/var/www/path/to/file`
- ä½¿ç”¨é…ç½®æ–‡ä»¶ç»Ÿä¸€ç®¡ç†è·¯å¾„

### 2. æ•°æ®åº“å¯†ç 
- ä¸è¦ä½¿ç”¨é»˜è®¤å¯†ç  `postgres`
- ä½¿ç”¨å¼ºå¯†ç 
- ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç å¯†ç 

### 3. æ–‡ä»¶æƒé™
```bash
# è®¾ç½®æ­£ç¡®çš„æ–‡ä»¶æƒé™
sudo chown -R www-data:www-data /var/www/inspection_system
sudo chmod -R 755 /var/www/inspection_system
sudo chmod -R 777 /var/www/inspection_system/logs
sudo chmod -R 777 /var/www/inspection_system/uploads
```

### 4. é˜²ç«å¢™é…ç½®
```bash
# å¼€æ”¾å¿…è¦ç«¯å£
sudo ufw allow 80/tcp    # HTTP
sudo ufw allow 443/tcp   # HTTPS
sudo ufw allow 5001/tcp  # åº”ç”¨ç«¯å£ï¼ˆå¦‚æœç›´æ¥è®¿é—®ï¼‰
sudo ufw enable
```

### 5. æ—¥å¿—ç›‘æ§
```bash
# å®æ—¶æŸ¥çœ‹åº”ç”¨æ—¥å¿—
tail -f /var/www/inspection_system/logs/app.log

# æŸ¥çœ‹Gunicornæ—¥å¿—
tail -f /var/www/inspection_system/logs/error.log

# æŸ¥çœ‹ç³»ç»ŸæœåŠ¡æ—¥å¿—
sudo journalctl -u inspection -f
```

---

## ğŸ“ æ•…éšœæ’æŸ¥

### é—®é¢˜1: æ•°æ®åº“è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥PostgreSQLçŠ¶æ€
sudo systemctl status postgresql

# æµ‹è¯•è¿æ¥
psql -U inspection_user -d configurable_ops -h localhost

# æ£€æŸ¥é…ç½®
cat .env | grep DATABASE_URL
```

### é—®é¢˜2: ç™½åå•æ–‡ä»¶æ‰¾ä¸åˆ°
```bash
# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la data/whitelist.xlsx

# æ£€æŸ¥è·¯å¾„é…ç½®
cat .env | grep WHITELIST_FILE

# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la data/
```

### é—®é¢˜3: ç«¯å£è¢«å ç”¨
```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
sudo netstat -tulpn | grep 5001

# ä¿®æ”¹ç«¯å£
nano .env
# ä¿®æ”¹ PORT=5002

# é‡å¯æœåŠ¡
sudo systemctl restart inspection
```

### é—®é¢˜4: æƒé™ä¸è¶³
```bash
# ä¿®å¤æƒé™
sudo chown -R www-data:www-data /var/www/inspection_system
sudo chmod -R 755 /var/www/inspection_system
```

---

## âœ¨ ä¼˜åŒ–å»ºè®®

### 1. ä½¿ç”¨Nginxåå‘ä»£ç†
- æä¾›é™æ€æ–‡ä»¶æœåŠ¡
- è´Ÿè½½å‡è¡¡
- SSLç»ˆæ­¢
- è¯·æ±‚é™æµ

### 2. é…ç½®Redisç¼“å­˜ï¼ˆå¯é€‰ï¼‰
- ç¼“å­˜è¿è¥äººå‘˜åˆ—è¡¨
- ç¼“å­˜ç»Ÿè®¡æ•°æ®
- æå‡å“åº”é€Ÿåº¦

### 3. é…ç½®CDNï¼ˆå¯é€‰ï¼‰
- åŠ é€Ÿå›¾ç‰‡åŠ è½½
- å‡è½»æœåŠ¡å™¨å‹åŠ›

### 4. ç›‘æ§å’Œå‘Šè­¦
- ä½¿ç”¨Prometheusç›‘æ§
- é…ç½®å‘Šè­¦è§„åˆ™
- å®šæœŸæ£€æŸ¥æ—¥å¿—

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [äº‘æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—.md](äº‘æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—.md) - å®Œæ•´éƒ¨ç½²æ­¥éª¤
- [ä½¿ç”¨æ–‡æ¡£.md](ä½¿ç”¨æ–‡æ¡£.md) - ç³»ç»Ÿä½¿ç”¨è¯´æ˜
- [README.md](README.md) - é¡¹ç›®æ¦‚è¿°

---

## ğŸ¯ ä¸‹ä¸€æ­¥

1. é˜…è¯» [äº‘æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—.md](äº‘æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—.md)
2. å‡†å¤‡äº‘æœåŠ¡å™¨ç¯å¢ƒ
3. æŒ‰ç…§æ¸…å•é€é¡¹å®Œæˆéƒ¨ç½²
4. æµ‹è¯•æ‰€æœ‰åŠŸèƒ½
5. é…ç½®ç›‘æ§å’Œå¤‡ä»½
