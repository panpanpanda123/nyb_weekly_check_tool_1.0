# äº‘æœåŠ¡å™¨éƒ¨ç½² - æ€»ç»“æŠ¥å‘Š

## ğŸ“Š æ£€æŸ¥ç»“æœ

æˆ‘å·²ç»å…¨é¢æ£€æŸ¥äº†æ‚¨çš„é¡¹ç›®ï¼Œå¹¶ä¸ºäº‘æœåŠ¡å™¨éƒ¨ç½²åšå¥½äº†å‡†å¤‡ã€‚

### ğŸ” å‘ç°çš„ä¸»è¦é—®é¢˜

#### 1. **ç¡¬ç¼–ç çš„Windowsè·¯å¾„** âš ï¸ ä¸¥é‡
```python
# åœ¨app.pyçš„3ä¸ªä½ç½®
whitelist_file = 'D:/pythonproject/Newyobo_operat_database/daily_data/whitelist/whitelist.xlsx'
```
**å½±å“**: åœ¨Linuxäº‘æœåŠ¡å™¨ä¸Šæ— æ³•è¿è¡Œ
**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨é…ç½®æ–‡ä»¶ç®¡ç†è·¯å¾„

#### 2. **Flaskå¼€å‘æœåŠ¡å™¨** âš ï¸ ä¸¥é‡
```python
app.run(host='0.0.0.0', port=5001, debug=True)
```
**å½±å“**: ä¸é€‚åˆç”Ÿäº§ç¯å¢ƒï¼Œæ€§èƒ½å·®ï¼Œä¸ç¨³å®š
**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨Gunicornä½œä¸ºWSGIæœåŠ¡å™¨

#### 3. **ç¼ºå°‘ç¯å¢ƒé…ç½®** âš ï¸ ä¸­ç­‰
- æ²¡æœ‰é…ç½®æ–‡ä»¶ç®¡ç†
- æ²¡æœ‰ç¯å¢ƒå˜é‡æ”¯æŒ
- é…ç½®ç¡¬ç¼–ç åœ¨ä»£ç ä¸­

**è§£å†³æ–¹æ¡ˆ**: åˆ›å»ºconfig.pyå’Œ.envæ–‡ä»¶

#### 4. **ç¼ºå°‘æ—¥å¿—ç®¡ç†** âš ï¸ ä¸­ç­‰
- åªæœ‰printè¾“å‡º
- æ²¡æœ‰æ—¥å¿—æ–‡ä»¶
- éš¾ä»¥è¿½è¸ªé—®é¢˜

**è§£å†³æ–¹æ¡ˆ**: é…ç½®Python loggingæ¨¡å—

---

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. åˆ›å»ºçš„æ–°æ–‡ä»¶

| æ–‡ä»¶å | ç”¨é€” | é‡è¦æ€§ |
|--------|------|--------|
| `config.py` | ç»Ÿä¸€é…ç½®ç®¡ç† | â­â­â­â­â­ |
| `.env.example` | ç¯å¢ƒå˜é‡æ¨¡æ¿ | â­â­â­â­â­ |
| `app_cloud.py` | äº‘æœåŠ¡å™¨é€‚é…ç‰ˆæœ¬ | â­â­â­â­â­ |
| `gunicorn_config.py` | Gunicorné…ç½® | â­â­â­â­ |
| `start_server.sh` | å¯åŠ¨è„šæœ¬ | â­â­â­â­ |
| `äº‘æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—.md` | å®Œæ•´éƒ¨ç½²æ–‡æ¡£ | â­â­â­â­â­ |
| `ä»£ç ä¿®æ”¹æ¸…å•.md` | ä¿®æ”¹æ£€æŸ¥æ¸…å• | â­â­â­â­ |
| `migrate_to_cloud.py` | è‡ªåŠ¨è¿ç§»è„šæœ¬ | â­â­â­ |

### 2. æ›´æ–°çš„æ–‡ä»¶

| æ–‡ä»¶å | ä¿®æ”¹å†…å®¹ |
|--------|----------|
| `requirements.txt` | æ·»åŠ gunicorn, python-dotenv, gevent |

---

## ğŸ¯ ä¸¤ç§éƒ¨ç½²æ–¹æ¡ˆ

### æ–¹æ¡ˆA: ä½¿ç”¨app_cloud.pyï¼ˆæ¨èï¼‰âœ…

**ä¼˜ç‚¹**:
- âœ… ä¸å½±å“ç°æœ‰ä»£ç 
- âœ… å¯ä»¥åŒæ—¶ç»´æŠ¤æœ¬åœ°å’Œäº‘ç«¯ç‰ˆæœ¬
- âœ… é…ç½®æ›´çµæ´»
- âœ… å·²ç»å®Œå…¨é€‚é…äº‘æœåŠ¡å™¨

**æ­¥éª¤**:
1. ä¸Šä¼ æ‰€æœ‰æ–‡ä»¶åˆ°äº‘æœåŠ¡å™¨
2. å¤åˆ¶ `.env.example` ä¸º `.env` å¹¶ä¿®æ”¹é…ç½®
3. è¿è¡Œ `./start_server.sh`
4. é€‰æ‹©ç”Ÿäº§æ¨¡å¼å¯åŠ¨

**å¯åŠ¨å‘½ä»¤**:
```bash
# å¼€å‘æ¨¡å¼
python3 app_cloud.py

# ç”Ÿäº§æ¨¡å¼
gunicorn -c gunicorn_config.py app_cloud:app
```

### æ–¹æ¡ˆB: ä¿®æ”¹ç°æœ‰app.py

**ä¼˜ç‚¹**:
- âœ… ä¿æŒåŸæœ‰æ–‡ä»¶å
- âœ… ä¸éœ€è¦ä¿®æ”¹å¯åŠ¨å‘½ä»¤

**æ­¥éª¤**:
1. è¿è¡Œè‡ªåŠ¨è¿ç§»è„šæœ¬: `python migrate_to_cloud.py`
2. æˆ–æ‰‹åŠ¨ä¿®æ”¹3å¤„ä»£ç ï¼ˆè§ä»£ç ä¿®æ”¹æ¸…å•.mdï¼‰

**éœ€è¦ä¿®æ”¹çš„ä½ç½®**:
- ç¬¬278è¡Œ: whitelist_fileè·¯å¾„
- ç¬¬331è¡Œ: whitelist_fileè·¯å¾„
- ç¬¬401è¡Œ: whitelist_fileè·¯å¾„
- æœ€åä¸€è¡Œ: app.run()é…ç½®

---

## ğŸ“‹ éƒ¨ç½²æ­¥éª¤æ¦‚è§ˆ

### é˜¶æ®µ1: æœ¬åœ°å‡†å¤‡ï¼ˆ5åˆ†é’Ÿï¼‰
```bash
# 1. è¿è¡Œè¿ç§»è„šæœ¬
python migrate_to_cloud.py

# 2. åˆ›å»º.envæ–‡ä»¶
cp .env.example .env
# ç¼–è¾‘.envï¼Œé…ç½®æ•°æ®åº“ç­‰ä¿¡æ¯

# 3. æµ‹è¯•æœ¬åœ°è¿è¡Œ
python app_cloud.py
```

### é˜¶æ®µ2: äº‘æœåŠ¡å™¨ç¯å¢ƒå‡†å¤‡ï¼ˆ15åˆ†é’Ÿï¼‰
```bash
# 1. æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# 2. å®‰è£…ä¾èµ–
sudo apt install python3 python3-pip python3-venv postgresql nginx -y

# 3. é…ç½®PostgreSQL
sudo -u postgres psql
CREATE DATABASE configurable_ops;
CREATE USER inspection_user WITH PASSWORD 'your_password';
GRANT ALL PRIVILEGES ON DATABASE configurable_ops TO inspection_user;
\q
```

### é˜¶æ®µ3: ä¸Šä¼ å’Œé…ç½®ï¼ˆ10åˆ†é’Ÿï¼‰
```bash
# 1. ä¸Šä¼ é¡¹ç›®æ–‡ä»¶
scp -r ./* user@server:/var/www/inspection_system/

# 2. SSHåˆ°æœåŠ¡å™¨
ssh user@server

# 3. é…ç½®ç¯å¢ƒ
cd /var/www/inspection_system
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt

# 4. ç¼–è¾‘.envæ–‡ä»¶
nano .env
```

### é˜¶æ®µ4: åˆå§‹åŒ–å’Œæµ‹è¯•ï¼ˆ5åˆ†é’Ÿï¼‰
```bash
# 1. åˆå§‹åŒ–æ•°æ®åº“
python init_database.py

# 2. æµ‹è¯•è¿è¡Œ
./start_server.sh
# é€‰æ‹©å¼€å‘æ¨¡å¼æµ‹è¯•

# 3. è®¿é—®æµ‹è¯•
curl http://localhost:5001
```

### é˜¶æ®µ5: ç”Ÿäº§éƒ¨ç½²ï¼ˆ10åˆ†é’Ÿï¼‰
```bash
# 1. é…ç½®SystemdæœåŠ¡
sudo nano /etc/systemd/system/inspection.service
# ç²˜è´´æœåŠ¡é…ç½®

# 2. å¯åŠ¨æœåŠ¡
sudo systemctl daemon-reload
sudo systemctl start inspection
sudo systemctl enable inspection

# 3. é…ç½®Nginxï¼ˆå¯é€‰ï¼‰
sudo nano /etc/nginx/sites-available/inspection
# ç²˜è´´Nginxé…ç½®

# 4. é…ç½®é˜²ç«å¢™
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw enable
```

**æ€»è®¡æ—¶é—´**: çº¦45åˆ†é’Ÿ

---

## ğŸ”‘ å…³é”®é…ç½®é¡¹

### 1. æ•°æ®åº“è¿æ¥ï¼ˆ.envæ–‡ä»¶ï¼‰
```bash
DATABASE_URL=postgresql://inspection_user:your_strong_password@localhost:5432/configurable_ops
```
âš ï¸ **é‡è¦**: ä¿®æ”¹å¯†ç ï¼Œä¸è¦ä½¿ç”¨é»˜è®¤å€¼

### 2. æ–‡ä»¶è·¯å¾„ï¼ˆ.envæ–‡ä»¶ï¼‰
```bash
WHITELIST_FILE=/var/www/inspection_system/data/whitelist.xlsx
EXCEL_FILE=æ£€æŸ¥é¡¹è®°å½•.xlsx
```
âš ï¸ **é‡è¦**: ä½¿ç”¨Linuxç»å¯¹è·¯å¾„

### 3. å®‰å…¨å¯†é’¥ï¼ˆ.envæ–‡ä»¶ï¼‰
```bash
SECRET_KEY=ç”Ÿæˆä¸€ä¸ªéšæœºçš„é•¿å­—ç¬¦ä¸²
```
âš ï¸ **é‡è¦**: ä½¿ç”¨éšæœºç”Ÿæˆçš„å¯†é’¥

ç”Ÿæˆå‘½ä»¤:
```bash
python3 -c "import secrets; print(secrets.token_hex(32))"
```

### 4. ç®¡ç†å‘˜ç”¨æˆ·ï¼ˆ.envæ–‡ä»¶ï¼‰
```bash
ADMIN_USERS=çª¦,ç®¡ç†å‘˜,å…¶ä»–ç®¡ç†å‘˜
```

---

## ğŸ“ æ–‡ä»¶ç»“æ„ï¼ˆäº‘æœåŠ¡å™¨ï¼‰

```
/var/www/inspection_system/
â”œâ”€â”€ venv/                      # Pythonè™šæ‹Ÿç¯å¢ƒ
â”œâ”€â”€ logs/                      # æ—¥å¿—ç›®å½•
â”‚   â”œâ”€â”€ app.log               # åº”ç”¨æ—¥å¿—
â”‚   â”œâ”€â”€ access.log            # è®¿é—®æ—¥å¿—
â”‚   â””â”€â”€ error.log             # é”™è¯¯æ—¥å¿—
â”œâ”€â”€ data/                      # æ•°æ®ç›®å½•
â”‚   â””â”€â”€ whitelist.xlsx        # ç™½åå•æ–‡ä»¶
â”œâ”€â”€ uploads/                   # ä¸Šä¼ ç›®å½•
â”œâ”€â”€ static/                    # é™æ€æ–‡ä»¶
â”œâ”€â”€ templates/                 # HTMLæ¨¡æ¿
â”œâ”€â”€ .env                       # ç¯å¢ƒå˜é‡ï¼ˆä¸è¦æäº¤åˆ°gitï¼‰
â”œâ”€â”€ config.py                  # é…ç½®æ–‡ä»¶
â”œâ”€â”€ app_cloud.py              # åº”ç”¨ä¸»æ–‡ä»¶
â”œâ”€â”€ gunicorn_config.py        # Gunicorné…ç½®
â”œâ”€â”€ database.py               # æ•°æ®åº“æ¨¡å‹
â”œâ”€â”€ data_loader.py            # æ•°æ®åŠ è½½
â”œâ”€â”€ review_manager_db.py      # å®¡æ ¸ç®¡ç†
â”œâ”€â”€ csv_exporter.py           # CSVå¯¼å‡º
â”œâ”€â”€ whitelist_loader.py       # ç™½åå•åŠ è½½
â”œâ”€â”€ requirements.txt          # Pythonä¾èµ–
â””â”€â”€ start_server.sh           # å¯åŠ¨è„šæœ¬
```

---

## ğŸ”’ å®‰å…¨æ£€æŸ¥æ¸…å•

- [ ] ä¿®æ”¹æ•°æ®åº“é»˜è®¤å¯†ç 
- [ ] ç”ŸæˆéšæœºSECRET_KEY
- [ ] é…ç½®é˜²ç«å¢™è§„åˆ™
- [ ] ä½¿ç”¨HTTPSï¼ˆé…ç½®SSLè¯ä¹¦ï¼‰
- [ ] é™åˆ¶æ–‡ä»¶ä¸Šä¼ å¤§å°
- [ ] é…ç½®Nginxå®‰å…¨å¤´
- [ ] å®šæœŸæ›´æ–°ç³»ç»Ÿå’Œä¾èµ–
- [ ] é…ç½®æ—¥å¿—è½®è½¬
- [ ] è®¾ç½®è‡ªåŠ¨å¤‡ä»½
- [ ] ç›‘æ§å¼‚å¸¸è®¿é—®

---

## ğŸ› å¸¸è§é—®é¢˜é€ŸæŸ¥

### Q1: æ•°æ®åº“è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥PostgreSQLçŠ¶æ€
sudo systemctl status postgresql

# æ£€æŸ¥è¿æ¥é…ç½®
cat .env | grep DATABASE_URL

# æµ‹è¯•è¿æ¥
psql -U inspection_user -d configurable_ops -h localhost
```

### Q2: ç™½åå•æ–‡ä»¶æ‰¾ä¸åˆ°
```bash
# æ£€æŸ¥æ–‡ä»¶
ls -la data/whitelist.xlsx

# æ£€æŸ¥é…ç½®
cat .env | grep WHITELIST_FILE

# ä¸Šä¼ æ–‡ä»¶
scp whitelist.xlsx user@server:/var/www/inspection_system/data/
```

### Q3: ç«¯å£è¢«å ç”¨
```bash
# æŸ¥çœ‹å ç”¨
sudo netstat -tulpn | grep 5001

# ä¿®æ”¹ç«¯å£
nano .env
# ä¿®æ”¹ PORT=5002

# é‡å¯
sudo systemctl restart inspection
```

### Q4: æƒé™é—®é¢˜
```bash
# ä¿®å¤æƒé™
sudo chown -R www-data:www-data /var/www/inspection_system
sudo chmod -R 755 /var/www/inspection_system
sudo chmod -R 777 /var/www/inspection_system/logs
sudo chmod -R 777 /var/www/inspection_system/uploads
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. Gunicorné…ç½®
```python
# gunicorn_config.py
workers = CPUæ ¸å¿ƒæ•° * 2 + 1
worker_class = 'gevent'  # å¼‚æ­¥worker
threads = 2
```

### 2. æ•°æ®åº“è¿æ¥æ± 
```python
# config.py
SQLALCHEMY_POOL_SIZE = 10
SQLALCHEMY_MAX_OVERFLOW = 20
```

### 3. Nginxç¼“å­˜
```nginx
# é™æ€æ–‡ä»¶ç¼“å­˜
location /static {
    expires 30d;
    add_header Cache-Control "public, immutable";
}
```

### 4. æ—¥å¿—è½®è½¬
```bash
# /etc/logrotate.d/inspection
/var/www/inspection_system/logs/*.log {
    daily
    rotate 30
    compress
    delaycompress
    notifempty
    create 0640 www-data www-data
}
```

---

## ğŸ“ˆ ç›‘æ§å»ºè®®

### 1. ç³»ç»Ÿç›‘æ§
```bash
# å®‰è£…htop
sudo apt install htop

# å®æ—¶ç›‘æ§
htop
```

### 2. åº”ç”¨ç›‘æ§
```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
tail -f logs/app.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f logs/error.log

# æŸ¥çœ‹ç³»ç»ŸæœåŠ¡
sudo systemctl status inspection
```

### 3. æ•°æ®åº“ç›‘æ§
```bash
# è¿æ¥æ•°
psql -U postgres -c "SELECT count(*) FROM pg_stat_activity;"

# æ•°æ®åº“å¤§å°
psql -U postgres -c "SELECT pg_size_pretty(pg_database_size('configurable_ops'));"
```

---

## ğŸ“ å­¦ä¹ èµ„æº

- [Flaskéƒ¨ç½²æ–‡æ¡£](https://flask.palletsprojects.com/en/2.3.x/deploying/)
- [Gunicornæ–‡æ¡£](https://docs.gunicorn.org/)
- [Nginxé…ç½®æŒ‡å—](https://nginx.org/en/docs/)
- [PostgreSQLæ–‡æ¡£](https://www.postgresql.org/docs/)
- [SystemdæœåŠ¡ç®¡ç†](https://www.freedesktop.org/software/systemd/man/systemd.service.html)

---

## âœ… æœ€ç»ˆæ£€æŸ¥

éƒ¨ç½²å®Œæˆåï¼Œè¯·ç¡®è®¤ä»¥ä¸‹åŠŸèƒ½æ­£å¸¸ï¼š

- [ ] ç½‘é¡µå¯ä»¥æ­£å¸¸è®¿é—®
- [ ] å¯ä»¥æŸ¥çœ‹æ£€æŸ¥é¡¹åˆ—è¡¨
- [ ] å¯ä»¥è¿›è¡Œå®¡æ ¸æ“ä½œ
- [ ] å®¡æ ¸ç»“æœæ­£ç¡®ä¿å­˜åˆ°æ•°æ®åº“
- [ ] å¯ä»¥æŒ‰è¿è¥äººå‘˜ç­›é€‰
- [ ] ç»Ÿè®¡æ•°æ®æ­£ç¡®æ˜¾ç¤º
- [ ] å¯ä»¥å¯¼å‡ºCSVæ–‡ä»¶
- [ ] ç®¡ç†å‘˜å¯ä»¥ä¸Šä¼ æ–°æ–‡ä»¶
- [ ] ç®¡ç†å‘˜å¯ä»¥é‡ç½®æ•°æ®
- [ ] æ—¥å¿—æ­£å¸¸è®°å½•

---

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶
2. æ£€æŸ¥é…ç½®æ–‡ä»¶
3. å‚è€ƒäº‘æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—.md
4. æŸ¥çœ‹ä»£ç ä¿®æ”¹æ¸…å•.md
5. è¿è¡Œè¯Šæ–­å‘½ä»¤

---

## ğŸ‰ æ€»ç»“

æ‚¨çš„é¡¹ç›®å·²ç»å‡†å¤‡å¥½éƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨äº†ï¼

**æ¨èæ–¹æ¡ˆ**: ä½¿ç”¨ `app_cloud.py` + `.env` é…ç½®

**é¢„è®¡éƒ¨ç½²æ—¶é—´**: 45åˆ†é’Ÿ

**éš¾åº¦**: â­â­â­â˜†â˜† (ä¸­ç­‰)

ç¥éƒ¨ç½²é¡ºåˆ©ï¼ğŸš€
